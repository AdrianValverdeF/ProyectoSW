<div class="editor-eventos-container">

    <form action="/contenido/eventos/crear" method="POST" id="eventoForm">
        <div class="form-group">
            <label for="deporte">Deporte:</label>
            <select id="deporte" name="deporte" required class="filtro-control">
                <option value="">Seleccione un deporte</option>
                <option value="FUTBOL 11">Fútbol 11</option>
                <option value="FUTBOL 7">Fútbol 7</option>
                <option value="FUTBOL SALA">Fútbol sala</option>
                <option value="BALONCESTO">Baloncesto</option>
                <option value="RUGBY">Rugby</option>
                <option value="VOLEIBOL">Voleibol</option>
            </select>
        </div>

        <div class="form-group">
            <label for="genero">Género:</label>
            <select id="genero" name="genero" required class="filtro-control">
                <option value="">Seleccione género</option>
                <option value="M">Masculino</option>
                <option value="F">Femenino</option>
            </select>
        </div>

        <div class="form-group">
            <label for="equipoA">Equipo A:</label>
            <select id="equipoA" name="equipoA" required>
                <option value="">Seleccione primero deporte y género</option>
                <% equipos.forEach(equipo=> { %>
                    <option value="<%= equipo.id %>" data-deporte="<%= equipo.deporte %>"
                        data-genero="<%= equipo.genero %>" <%=(equipoA==equipo.id) ? 'selected' : '' %>>
                        <%= equipo.nombre %>
                    </option>
                    <% }); %>
            </select>
        </div>

        <div class="form-group">
            <label for="equipoB">Equipo B:</label>
            <select id="equipoB" name="equipoB" required>
                <option value="">Seleccione primero deporte y género</option>
                <% equipos.forEach(equipo=> { %>
                    <option value="<%= equipo.id %>" data-deporte="<%= equipo.deporte %>"
                        data-genero="<%= equipo.genero %>" <%=(equipoB==equipo.id) ? 'selected' : '' %>>
                        <%= equipo.nombre %>
                    </option>
                    <% }); %>
            </select>
        </div>

        <div class="form-group">
            <label for="fecha">Fecha:</label>
            <input type="date" id="fecha" name="fecha" required
                value="<%= fecha ? new Date(fecha).toISOString().split('T')[0] : '' %>">
        </div>

        <div class="form-actions">
            <a href="/contenido/eventos" class="admin-btn danger">Cancelar</a>
            <button type="submit" class="admin-btn">Crear Evento</button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const deporteSelect = document.getElementById('deporte');
        const generoSelect = document.getElementById('genero');
        const equipoASelect = document.getElementById('equipoA');
        const equipoBSelect = document.getElementById('equipoB');

        function filtrarEquipos() {
            const deporteSeleccionado = deporteSelect.value;
            const generoSeleccionado = generoSelect.value;

            [equipoASelect, equipoBSelect].forEach(select => {
                const valorActual = select.value;
                let seleccionValida = false;

                Array.from(select.options).forEach(option => {
                    if (option.value === "") {
                        option.style.display = "";
                        option.disabled = false;
                        return;
                    }

                    const coincideDeporte = !deporteSeleccionado || option.dataset.deporte === deporteSeleccionado;
                    const coincideGenero = !generoSeleccionado || option.dataset.genero === generoSeleccionado;
                    const mostrarOpcion = coincideDeporte && coincideGenero;

                    option.style.display = mostrarOpcion ? "" : "none";
                    option.disabled = !mostrarOpcion;

                    if (mostrarOpcion && option.value === valorActual) {
                        seleccionValida = true;
                    }
                });

                // Reset selection if current selection is invalid
                if (!seleccionValida && select.value) {
                    select.value = "";
                }
            });
        }

        // Initialize filters
        deporteSelect.addEventListener('change', filtrarEquipos);
        generoSelect.addEventListener('change', filtrarEquipos);

        // Prevent selecting same team for both sides
        equipoASelect.addEventListener('change', function () {
            if (this.value === equipoBSelect.value) {
                equipoBSelect.value = "";
            }
        });

        equipoBSelect.addEventListener('change', function () {
            if (this.value === equipoASelect.value) {
                equipoASelect.value = "";
            }
        });

        // Initial filter
        filtrarEquipos();
    });
</script>